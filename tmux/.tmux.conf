###############################################################################
# Prefix and Basic Settings
###############################################################################

# Unbind the default prefix (C-b) and set the prefix to C-a
unbind C-b
set -g prefix C-a

# Human-friendly window/pane indices (starting at 1 instead of 0)
set -g base-index 1
setw -g pane-base-index 1

# Enable focus events (useful for auto-updating buffers in Vim, for example)
set -g focus-events on

# Set default terminal type for tmux. 
# If you want italics in Vim/Tmux, consider "tmux-256color-italic" or similar.
set -g default-terminal "tmux"

# Force or override to ensure 256 color support
set -ga terminal-overrides "xterm-256color"

# Prevent tmux from renaming windows automatically
set-option -g allow-rename off

###############################################################################
# Splits, Pane Navigation, and Window Management
###############################################################################

# Split panes (vertical/horizontal) with custom keybindings
bind-key - split-window -v -c '#{pane_current_path}'
bind-key \ split-window -h -c '#{pane_current_path}'

# Set layout
bind = select-layout even-horizontal

# Swap windows easily
bind -r "<" swap-window -d -t -1
bind -r ">" swap-window -d -t +1

# Quick copy of pane text into nvim for editing (adjust to your editor of choice)
bind-key e send-keys "tmux capture-pane -p -S - | nvim -c 'set buftype=nofile' +" Enter

###############################################################################
# Mouse and General Key Bindings
###############################################################################

# Enable mouse interaction (scroll, select panes, etc.)
set -g mouse on

# Reload tmux config file (change file location if needed)
bind-key r source-file ~/.tmux.conf \; display-message "~/.tmux.conf reloaded"

# Resize pane with Ctrl + Alt + arrow keys
bind -n C-M-Left  resize-pane -L 2
bind -n C-M-Right resize-pane -R 2
bind -n C-M-Down  resize-pane -D 1
bind -n C-M-Up    resize-pane -U 1

###############################################################################
# Copy Mode and Clipboard
###############################################################################

# Use vi-style keybindings in copy mode
setw -g mode-keys vi

# Unbind the default copy-mode binding ([) and rebind Esc to enter copy-mode
unbind [
bind Escape copy-mode

# Begin selection with 'v' in copy-mode-vi
bind-key -T copy-mode-vi v send -X begin-selection

# Copy selection to macOS clipboard with 'y' or Enter, then cancel copy mode
bind-key -T copy-mode-vi y     send -X copy-pipe-and-cancel "pbcopy"
unbind -T copy-mode-vi Enter
bind-key -T copy-mode-vi Enter send -X copy-pipe-and-cancel "pbcopy"

# Unbind 'Space' and rebind it for advanced jump usage
unbind -T copy-mode-vi Space
bind   -T copy-mode-vi Space send -X jump-again

# Extra copy commands for convenience
bind-key -T copy-mode-vi 0 send -X back-to-indentation
bind y run 'tmux save-buffer - | pbcopy '
bind C-y run 'tmux save-buffer - | pbcopy '

# By default, prevent syncing system clipboard automatically:
set -g set-clipboard off

###############################################################################
# Plugins and Theme
###############################################################################

# List of plugins to be managed by Tmux Plugin Manager (TPM)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'wfxr/tmux-fzf-url'  # prefix + u for URL search
# set -g @plugin 'dracula/tmux'
# set -g @plugin 'catppuccin/tmux'
# ...
set -g @plugin 'catppuccin/tmux#v2.1.2'
set -g @plugin 'fcsonline/tmux-thumbs'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'

# Run a custom script that detects system dark/light mode and sets Catppuccin theme flavour
run-shell ~/.tmux/theme.sh

###############################################################################
# Status Line
###############################################################################

# Set status line position, length, and components
set -g status-position bottom      # can also be top
set -g status-right-length 100
set -g status-left-length 100
set -g status-left ''

# Use Catppuccin plugin's placeholders for advanced status segments
set -g status-right "#{E:@catppuccin_status_application}"
set -agF status-right "#{E:@catppuccin_status_cpu}"
set -ag status-right "#{E:@catppuccin_status_session}"
set -ag status-right "#{E:@catppuccin_status_uptime}"
set -agF status-right "#{E:@catppuccin_status_battery}"

# Configure how windows are displayed in the status line
set -g @catppuccin_window_text " #W"
set -g @catppuccin_window_number "#I"
set -g @catppuccin_window_current_text " #W"
set -g @catppuccin_window_current_number "#I"

# Example or extra Catppuccin plugin config:
# set -g @catppuccin_status_modules "session date_time"
# set -g @catppuccin_date_time_text "%Y-%m-%d"

###############################################################################
# Tmux Thumbs
###############################################################################

# Integrates tmux-thumbs for advanced text selection
run-shell ~/.tmux/plugins/tmux-thumbs/tmux-thumbs.tmux
# set -g @thumbs-key t
# bind-key -r \; thumbs-pick
set -g @thumbs-command 'echo -n {} | pbcopy'

###############################################################################
# Final Plugin Initialization
###############################################################################

# Initialize TPM (Tmux Plugin Manager) - keep at the bottom
run '~/.tmux/plugins/tpm/tpm'
